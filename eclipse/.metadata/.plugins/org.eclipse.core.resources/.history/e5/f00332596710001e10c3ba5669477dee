package appu26j.mods.visuals;

import org.lwjgl.opengl.GL11;

import com.google.common.eventbus.Subscribe;

import appu26j.events.render.EventRender3D;
import appu26j.interfaces.ModInterface;
import appu26j.mods.Category;
import appu26j.mods.Mod;
import net.minecraft.client.renderer.GlStateManager;
import net.minecraft.client.renderer.Tessellator;
import net.minecraft.client.renderer.WorldRenderer;
import net.minecraft.client.renderer.vertex.DefaultVertexFormats;

@ModInterface(name = "Cat Ears", description = "A cosmetic which gives you cat ears! Author: DistastefulBannock", category = Category.VISUALS)
public class CatEars extends Mod
{
    @Subscribe
    public void onRender3D(EventRender3D e)
    {
        if (this.mc.gameSettings.thirdPersonView == 0)
        {
            return;
        }
        
        GlStateManager.pushMatrix();
        GlStateManager.enableDepth();
        
        if (this.mc.thePlayer.isSneaking())
        {
            GlStateManager.translate(0, -0.17, 0);
        }
        
        double pitchFixer = 0.2;
        float timer = this.mc.timer.renderPartialTicks;
        double yaw = this.mc.thePlayer.prevRotationYawHead + (this.mc.thePlayer.rotationYawHead - this.mc.thePlayer.prevRotationYawHead) * timer;
        GlStateManager.rotate((float) -yaw, 0, 1, 0);
        GlStateManager.rotate(90, 1, 0, 0);
        GlStateManager.translate(0, 0, -(mc.thePlayer.getEyeHeight() - pitchFixer));
        GlStateManager.rotate(this.mc.thePlayer.rotationPitch, 1, 0, 0);
        GlStateManager.translate(0, 0, -(0.27 + pitchFixer));
        Tessellator tessellator = Tessellator.getInstance();
        WorldRenderer worldrenderer = tessellator.getWorldRenderer();
        double headSize = 0.23;
        double earWidth = headSize * 0.7;
        double earLength = earWidth;
        double earSize = earWidth * 0.8;
        int mainEarR = 30;
        int mainEarG = 30;
        int mainEarB = 30;
        
        int innerEarR = 165;
        int innerEarG = 224;
        int innerEarB = 254;
        
        // Main ear
        worldrenderer.begin(GL11.GL_TRIANGLE_FAN, DefaultVertexFormats.POSITION_COLOR);
        worldrenderer.pos(headSize / 2, earSize, -earLength).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 - earWidth / 2, earSize, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2, 0, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 + earWidth / 2, earSize, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        tessellator.draw();
        worldrenderer.begin(GL11.GL_TRIANGLES, DefaultVertexFormats.POSITION_COLOR);
        worldrenderer.pos(headSize / 2 - earWidth / 2, earSize, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2, 0, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 + earWidth / 2, earSize, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        tessellator.draw();
        
        // Inner ear
        worldrenderer.begin(GL11.GL_TRIANGLE_FAN, DefaultVertexFormats.POSITION_COLOR);
        worldrenderer.pos(headSize / 2, earSize, -earLength * 0.7).color(innerEarR, innerEarG, innerEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 + earWidth / 2 - earLength * 0.23, earSize * 0.7 + earSize * 0.25 * 0.75, 0).color(innerEarR, innerEarG, innerEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2, earSize * 0.75, 0).color(mainEarR, innerEarR, innerEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 - earWidth / 2 + earLength * 0.23, earSize * 0.7 + earSize * 0.25 * 0.75, 0).color(innerEarR, innerEarG, innerEarB, 255).endVertex();
        tessellator.draw();
        worldrenderer.begin(GL11.GL_TRIANGLES, DefaultVertexFormats.POSITION_COLOR);
        worldrenderer.pos(headSize / 2 + earWidth / 2 - earLength * 0.23, earSize * 0.7 + earSize * 0.25 * 0.75, -0.001).color(innerEarR, innerEarG, innerEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2, earSize * 0.75, -0.001).color(mainEarR, innerEarR, innerEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 - earWidth / 2 + earLength * 0.23, earSize * 0.7 + earSize * 0.25 * 0.75, -0.001).color(innerEarR, innerEarG, innerEarB, 255).endVertex();
        tessellator.draw();
        
        headSize *= -1;
        
        // Main ear
        worldrenderer.begin(GL11.GL_TRIANGLE_FAN, DefaultVertexFormats.POSITION_COLOR);
        worldrenderer.pos(headSize / 2, earSize, -earLength).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 - earWidth / 2, earSize, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2, 0, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 + earWidth / 2, earSize, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        tessellator.draw();
        worldrenderer.begin(GL11.GL_TRIANGLES, DefaultVertexFormats.POSITION_COLOR);
        worldrenderer.pos(headSize / 2 - earWidth / 2, earSize, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2, 0, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 + earWidth / 2, earSize, 0).color(mainEarR, mainEarG, mainEarB, 255).endVertex();
        tessellator.draw();
        
        // Inner ear
        worldrenderer.begin(GL11.GL_TRIANGLE_FAN, DefaultVertexFormats.POSITION_COLOR);
        worldrenderer.pos(headSize / 2, earSize, -earLength * 0.7).color(innerEarR, innerEarG, innerEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 + earWidth / 2 - earLength * 0.23, earSize * 0.7 + earSize * 0.25 * 0.75, 0).color(innerEarR, innerEarG, innerEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2, earSize * 0.75, 0).color(mainEarR, innerEarR, innerEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 - earWidth / 2 + earLength * 0.23, earSize * 0.7 + earSize * 0.25 * 0.75, 0).color(innerEarR, innerEarG, innerEarB, 255).endVertex();
        tessellator.draw();
        worldrenderer.begin(GL11.GL_TRIANGLES, DefaultVertexFormats.POSITION_COLOR);
        worldrenderer.pos(headSize / 2 + earWidth / 2 - earLength * 0.23, earSize * 0.7 + earSize * 0.25 * 0.75, -0.001).color(innerEarR, innerEarG, innerEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2, earSize * 0.75, -0.001).color(mainEarR, innerEarR, innerEarB, 255).endVertex();
        worldrenderer.pos(headSize / 2 - earWidth / 2 + earLength * 0.23, earSize * 0.7 + earSize * 0.25 * 0.75, -0.001).color(innerEarR, innerEarG, innerEarB, 255).endVertex();
        tessellator.draw();
        
        GlStateManager.popMatrix();
    }
}
